# 操作系统知识——进程管理

## 基本概念

### 进程和程序

程序顺序执行的主要特征包括顺序性、封闭性和可再现性。

程序并发执行发的特征：失去程序封闭性；执行活动不再一一对应；并发程序之间存在相互制约性。

### 进程的组成
PCB  进程唯一标志：包括进程标识符、状态、位置信息、控制信息、队列指针、优先级、现场保护区、其他。

程序：进程完成的功能

数据：进程所需要的数据以及工作区。

### 进程的状态及其状态间的转换
三态模型
运行---就绪---阻塞

- 运行：正在处理机上运行。
- 就绪：进程获得了除处理机外的所有资源
- 阻塞：进程正在等待某一时间发生或者有资源没有准备好。

五态模型：运行、就绪、阻塞、终止、新建。

- 新建：程序刚刚被建立时
- 终止：程序运行完成，进入终止状态。操作系统对其进行善后处理，并释放内存。

挂起状态之间的内存转换：
- 活跃就绪：在主存，可以被调度
- 静止就绪：不在主存，不能被直接调度的状态，需要转换到活跃就绪才能被调度。
- 活跃阻塞：进程在主存。一旦等待的事件产生进入活跃状态。
- 静止阻塞：阻塞的进程进入了辅存时的状态。

## 进程的控制
进程控制由操作系统原语实现的。原语是由若干条机器指令组成的，用于完成特定功能的程序段。原语的特点是在执行的时候不可被分割。

## 进程间的通信
同步：多个进程可以并发执行，各个进程可以相互独立且不可预知的速度向前推进，但是需要在某些确定上调用相互合作进程之间的工作。这样的进程之间的联系称之为进程间的通信。

互斥：进程间争用临界资源产生。只能同时给一个资源使用的资源称之为临界资源。

临界区：对临界资源使用的那段程序。

临界区的管理原则：
- 有空则进
- 无空则等
- 有限等待
- 让权等待


信号量机制：
信号量是一个整型变量。它包括公用信号量和私用信号量。
公用信号量实现进程间的互斥，私用信号量实现进程间的同步。

信号量的意义。正整数为可用数，负数，其绝对值表示等待的进程数

两个操作：PV操作。

P操作：占用资源，或者进入等待队列。
V操作：释放资源。

PV操作的相关代码：
互斥
```C
  P(mutex);
  临界区
  V(mutex);
```

同步：
生产者与消费者问题

高级通信原语：解决PV操作的变成难度和效率问题

类别：
- 共享存储方式
- 消息传递方式
- 管道通信

## 管程
通过将资源集中管理的方法，将系统中的资源用某种数据结构表示出来。由于临界区是访问共享资源的代码段，建立一个管程管理进程提出的访问的进程。

管程实现的同步进程由“条件结构”提供。变量主要有notempty、notfull等。但是只能被wait和signal访问wait表示挂起，signal表示启动挂起的进程，若不挂起，就不改变notfull的状态。

管程的结构：过程、变量等

## 进程的调度
### 三级调度
- 高级调度（长调度、作业调度、接纳调度）：处于输入池中的后备作业调入主系统中做好运行的准备。
- 中级调度（中程调度、对换调度）：决定交换区中的哪个就绪进程可以进入内存，直接参与对CPU的竞争。
- 低级调度（短程调度进程调度）：内存中的进程哪个可以进入CPU中进行处理。

### 调度算法
- 先来先服务
- 时间片轮转
  - 可变时间片
  - 固定时间片
- 优先级调度
  - 静态优先级
  - 动态优先级
- 多级反馈调度：照顾短系统提高系统吞吐量；缩短IO响应时间；可动态调整优先级。实现思路：
  - 设置多个就绪队列
  - 时间片轮转算法
  - 抢先的进程投入队列末尾。

### 进程优先级确定：
考虑情况：
- IO型：进入高优先级
- 计算型：计算后进入比当前低一级优先级
- IO+计算型：计算完成后进行IO，进入高优先级，然后逐级下降。
- IO完成后提高优先级，进程时间片用完后降低优先级。

## 死锁
四个条件：
- 互斥
- 请求保持
- 环路
- 不可剥夺

*有向图画法：圈表示进程，正方形表示资源。圈指向正方形：请求资源，否则为分配资源*

处理方法：鸵鸟策略（不管它）、预防策略、避免策略、检测解除死锁

- 死锁预防：
  - 预先静态分配法
  - 资源有序分配法
- 死锁避免
  - 银行家算法：对线程安全性进行考虑，再做判断是否会进入死锁状态。
- 死锁检测
  - 使用一个死锁检测程序检测。
- 死锁解除
  - 资源剥夺
  - 撤销进程

## 线程
线程主要是与传统的进程的概念分开。线程是调度和分配的基本单位。有时称为轻型进程
进程是资源分配的基本单位。有时称为重型进程

线程可分为用户级线程和内核支持级线程